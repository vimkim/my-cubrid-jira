# CUBRID에 NIX 빌드 시스템 추가

## Description

CUBRID의 빌드 시스템을 현대화하고 결정론적(deterministic) 빌드 환경을 구축하기 위해 NIX 도입을 제안합니다. NIX는 순수 함수형 패키지 관리 시스템으로, 시스템 수준의 구성을 선언적으로 관리하며 완벽한 재현성을 보장합니다.

NIX의 핵심 기술적 특징은 다음과 같습니다:

1. 암호학적 해시 기반의 격리된 저장소 구조로 의존성 다이아몬드 문제를 원천적으로 해결합니다.
2. 함수형 프로그래밍 패러다임에 기반한 선언적 시스템 구성으로 사이드 이펙트를 배제합니다.
3. 원자적 트랜잭션과 세대(generation) 기반 구성 관리로 시스템 상태 롤백을 보장합니다.
4. 심볼릭 링크와 레이지 바인딩을 활용한 효율적인 다중 버전 패키지 관리를 제공합니다.

기존 컨테이너 기반 접근법과 비교했을 때 NIX는 다음과 같은 기술적 이점이 있습니다:

1. 격리 계층 없는 베어메탈 성능
   - 가상화나 컨테이너 런타임 오버헤드가 전혀 없습니다
   - 시스템 콜이 직접 호스트 커널에 전달됩니다
2. 선언적 시스템 구성
   - 전체 시스템 상태를 버전 관리 가능한 코드로 관리합니다
   - imperative한 셸 스크립트 대신 순수 함수형 설정을 사용합니다
3. 트랜잭션 기반 상태 관리
   - 모든 변경사항이 원자적으로 적용됩니다
   - 실패 시 자동 롤백을 보장합니다
4. 콘텐츠 주소 지정 저장소
   - 패키지와 설정이 해시값으로 고유하게 식별됩니다
   - 중복 저장을 방지하여 디스크 공간을 절약합니다
5. 격리된 개발 환경
   - nix-shell이 프로젝트별 독립 환경을 제공합니다
   - 시스템 라이브러리와의 의존성 충돌을 방지합니다

이러한 특징들을 통해 NIX는:

- glibc 버전
- 커널 버전
- 배포판 종류
  와 완전히 독립적인 빌드 환경을 제공하며, 단일 명령으로 모든 Linux 시스템에서 동일한 CUBRID 빌드 결과를 보장합니다.

일반적인 Dockerfile이 apt나 yum 같은 가변적인 패키지 매니저에 의존하여 재현성을 해치는 반면, NIX는 순수 함수형 접근으로 완벽한 재현성을 달성합니다.

### ARM 빌드

서드 파티 의존성 문제가 해결되면 이론 상 ARM 빌드도 지원합니다.
윈도우 빌드할 때와 동일하게, systemtap과 libelf만 제외한다면 (darwin 지원 안함) MacOS 빌드도 기대하고 있습니다.

## Spec Change

1. NIX 빌드 시스템 구성 파일 추가

   - flake.nix: 순수 함수형 빌드 파이프라인 정의
   - flake.lock: 의존성 트리의 결정론적 버전 관리

2. 빌드 환경 설정
   - 컴파일러 툴체인 및 빌드 시스템 구성
   - 시스템 라이브러리 의존성 명세
   - 빌드 파라미터 및 환경 변수 선언
3. 문서화
   - README.md 업데이트
   - NIX 기반 개발 환경 가이드
   - 트러블슈팅 매뉴얼

## Implementation

1. NIX 패키지 정의
   - 30 - 40 줄 정도의 간단한 flake.nix 추가

## Acceptance Criteria

1. 빌드 환경 재현성
   - 모든 Linux 배포판에서 바이트 단위 동일 빌드
   - glibc 무관
   - 커널 무관
2. 사용 편의성
   - nix develop 명령 한줄만으로 10분 이내 빌드 환경 구성
3. 안정성
   - 호스트 시스템 격리
   - 100% 빌드 성공률
   - 원자적 롤백
4. 성능
   - 네이티브 실행 속도
   - 최적화된 리소스 사용
   - 증분 빌드 지원
5. 문서화

이 시스템이 구현되면 CUBRID는 어떤 Linux 환경에서든 수 분 내에 동일한 개발/빌드 환경을 구성할 수 있게 됩니다. 이는 개발 생산성 향상에 크게 기여할 것입니다.

지원하는 리눅스 환경:

1. Rocky Linux
1. CentOS Stream, Fedora, Oracle Linux
1. Red Hat Enterprise Linux (RHEL)
1. Debian, Ubuntu...
1. Alpine Linux (Docker)
1. openSUSE
1. Slackware
1. NixOS
1. Arch Linux
1. Gentoo
1. LFS (Linux From Scratch)
1. 티맥스OS 등등...

이론 상 추후 지원 가능:

- Linux (aarch64).
- macOS (x86_64, aarch64).
